package main

import (
	"log"
	"os"
	"flag"

	"github.com/FiloSottile/CVE-2016-2107/LuckyMinus20"
)

func main() {
	timeOut := flag.Int("timeout", 20, "Connection timeout in seconds")
	address := flag.String("address", "127.0.0.1", "Server to test")
	flag.Parse()

	// Keeps compability with how it worked before command line flags
	if flag.NArg() == 1 {
		*address = os.Args[1]
	}

	res, err := LuckyMinus20.Test(*timeOut, *address)

	if err != nil {
		log.Fatal(err)
	}
	log.Println("Vulnerable:", res)
	if res {
		os.Exit(1)
	}
}
